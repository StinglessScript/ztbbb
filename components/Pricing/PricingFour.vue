<template>
  <div v-if="block.__component == 'pricing.pricing-four'">
    <template v-for="items in block?.productList">
      <div class="pricing-area ptb-80 bg-f9f6f6">
        <div class="container">
          <div class="section-title">
            <h2>{{ items.name }}</h2>
            <div class="bar"></div>
          </div>

          <div class="row justify-content-center">
            <div
              v-for="item in items.products"
              class="col-lg col-md-6 col-sm-6 mb-4"
              :class="{
                'col-lg-3':
                  items.products.length <= 3 || items.products.length >= 4,
              }"
              :key="item.id"
            >
              <ProductCsCardPricingFour :item="item" />
            </div>
          </div>
        </div>

        <div class="shape8 rotateme">
          <img src="~/assets/img/shape2.svg" />
        </div>
        <div class="shape2 rotateme">
          <img src="~/assets/img/shape2.svg" />
        </div>
        <div class="shape7"><img src="~/assets/img/shape4.svg" /></div>
        <div class="shape4"><img src="~/assets/img/shape4.svg" /></div>
      </div>
    </template>
  </div>
</template>

<script>
import Shape2 from "~/assets/img/shape2.svg";
import Shape4 from "~/assets/img/shape4.svg";
import ProductCsCardPricingFour from "@/components/Product/ProductCsCardPricingFour.vue";

export default {
  name: "Pricing",
  components: {
    Shape2,
    Shape4,
    ProductCsCardPricingFour,
  },
  props: {
    block: {
      type: Object,
      default: {},
    },
    productData: [],
  },

  data() {
    return {
      //product: {},
    };
  },

  mounted() {
    // this.handleGetPriceMenu(this.block?.categoryId);
  },

  methods: {
    // handleSale(price, originalPrice) {
    //   price = price.replaceAll(".", "");
    //   originalPrice = originalPrice.replaceAll(".", "");
    //   return (100 - (Number(price) / Number(originalPrice)) * 100).toFixed();
    // },
    // async handleGetPriceMenu(id) {
    //   const data = await this.$store.dispatch("getPriceMenus", id);
    //   if (data?.data?.getPriceMenus) {
    //     // L·∫•y danh s√°ch id c·ªßa t·∫•t c·∫£ c√°c s·∫£n ph·∫©m
    //     const ids = data.data.getPriceMenus.flatMap((menu) =>
    //       menu.products.map((product) => product.id)
    //     );
    //     // L·∫•y danh s√°ch gi√° d·ª±a tr√™n c√°c id s·∫£n ph·∫©m
    //     const responseListPrice = await this.$sdk.product.getListPrice(
    //       ids,
    //       this.$route.query.store
    //     );
    //     // C·∫≠p nh·∫≠t gi√° cho c√°c s·∫£n ph·∫©m trong getPriceMenus
    //     this.product = data.data.getPriceMenus.map((menu) => {
    //       return {
    //         ...menu, // Sao ch√©p c√°c thu·ªôc t√≠nh c·ªßa menu
    //         products: menu.products.map((item) => {
    //           const newItem = { ...item };
    //           // Kh·ªüi t·∫°o discountPrice n·∫øu ch∆∞a t·ªìn t·∫°i
    //           if (!newItem.discountPrice) {
    //             newItem.discountPrice = [];
    //           }
    //           // T√¨m gi√° t∆∞∆°ng ·ª©ng v·ªõi s·∫£n ph·∫©m d·ª±a tr√™n id
    //           const price = responseListPrice[item?.id] || [];
    //           // Duy·ªát qua c√°c ƒë·ªëi t∆∞·ª£ng trong subPrices v√† thay ƒë·ªïi type th√†nh type c·ªßa object cha
    //           const updatedPrice = price.flatMap((d) => {
    //             if (!d?.subPrices || d?.subPrices?.length === 0) {
    //               // N·∫øu kh√¥ng c√≥ subPrices, tr·∫£ v·ªÅ 1 ƒë·ªëi t∆∞·ª£ng m·∫∑c ƒë·ªãnh
    //               return [
    //                 {
    //                   time: d?.quantity || 1,
    //                   type: d?.type,
    //                   percentDiscount: d?.discountPercent || 0,
    //                   price: d?.price || 0,
    //                   hint: d?.hint || null,
    //                   priceDiscount:
    //                     d?.displayPrice || d?.price * (d?.quantity || 1) || 0,
    //                   unitDTO_id: newItem.unitDTO?.id || 1, // Default to 1 if unitDTO is not available
    //                   unitDTO_name: newItem.unitDTO?.name || "default", // Default name if not available
    //                   defaultPrice: d?.defaultPrice ? false : true, // Default to true when no subPrices
    //                   attributes: {
    //                     value: d?.attributes?.some(
    //                       (a) =>
    //                         a.attrName == "CAMPAIN" ||
    //                         a.attrName == "CAMPAIGN_ACTION"
    //                     ),
    //                     campain: d?.attributes || [],
    //                   },
    //                 },
    //               ];
    //             }
    //             // Tr∆∞·ªùng h·ª£p c√≥ subPrices, x·ª≠ l√Ω t·ª´ng ph·∫ßn t·ª≠ trong subPrices
    //             const subPriceData = d?.subPrices?.map((c) => {
    //               return {
    //                 time: c?.quantity, // Time (quantity)
    //                 type: c?.type == "QUANTITY" ? d?.type : c?.type,
    //                 percentDiscount: c?.discountPercent, // Discount percent
    //                 price: c?.price, // Price
    //                 hint: c?.hint || null, // Hint (or null if not provided)
    //                 priceDiscount:
    //                   c?.displayPrice || c?.price * (c?.quantity || 1) || 0, // Calculating priceDiscount
    //                 unitDTO_id: newItem.unitDTO?.id, // Unit DTO ID
    //                 unitDTO_name: newItem.unitDTO?.name, // Unit DTO Name
    //                 defaultPrice: d?.defaultPrice === c.id, // Checking if this is the default price
    //                 attributes: {
    //                   value: c?.attributes?.some(
    //                     (a) =>
    //                       a.attrName == "CAMPAIN" ||
    //                       a.attrName == "CAMPAIGN_ACTION"
    //                   ),
    //                   campain: c?.attributes || [],
    //                 },
    //               };
    //             });
    //             // Th√™m 1 ƒë·ªëi t∆∞·ª£ng m·∫∑c ƒë·ªãnh v√†o cu·ªëi m·∫£ng subPriceData n·∫øu c√≥ subPrices
    //             return [
    //               {
    //                 time: d?.quantity || 1,
    //                 type: d?.type,
    //                 percentDiscount: d?.discountPercent || 0,
    //                 price: d?.price || 0,
    //                 hint: d?.hint || null,
    //                 priceDiscount:
    //                   d?.displayPrice || d?.price * (d?.quantity || 1) || 0,
    //                 unitDTO_id: newItem.unitDTO?.id || 1, // Default to 1 if unitDTO is not available
    //                 unitDTO_name: newItem.unitDTO?.name || "Th√°ng", // Default name if not available
    //                 defaultPrice: d?.defaultPrice ? d?.defaultPrice == d?.id ? true : false : true, // Default to true when subPrices exist
    //                 attributes: {
    //                   value: d?.attributes?.some(
    //                     (a) =>
    //                       a.attrName == "CAMPAIN" ||
    //                       a.attrName == "CAMPAIGN_ACTION"
    //                   ),
    //                   campain: d?.attributes || [],
    //                 },
    //               },
    //               ...subPriceData,
    //             ];
    //           });
    //           let filterData = [...updatedPrice];
    //           //console.log("üöÄ ~ listData ~ filterData:", filterData)
    //           const updatedDataDiscount = [];
    //           // C√°c b∆∞·ªõc x·ª≠ l√Ω filterData v√† c·∫≠p nh·∫≠t dataDiscount
    //           filterData
    //             .filter((item) => item.type === "PROMOTION")
    //             .forEach((promotion) => {
    //               const matchingRentData = filterData.filter(
    //                 (rent) =>
    //                   (rent.type === "RENT" || rent.type === "SELL") &&
    //                   rent.time === promotion.time
    //               );
    //               if (matchingRentData.length > 0) {
    //                 promotion.oldPrice = matchingRentData;
    //                 updatedDataDiscount.push(promotion);
    //                 matchingRentData.forEach((rent) => {
    //                   const rentIndex = filterData.indexOf(rent);
    //                   if (rentIndex !== -1) {
    //                     filterData.splice(rentIndex, 1);
    //                   }
    //                 });
    //               } else {
    //                 updatedDataDiscount.push(promotion);
    //               }
    //             });
    //           filterData.forEach((item) => {
    //             if (item.type === "RENT" || item.type === "SELL") {
    //               updatedDataDiscount.push(item);
    //             }
    //           });
    //           updatedDataDiscount.forEach((price, index) => {
    //             price.number = index + 1;
    //           });
    //           updatedDataDiscount.forEach((discount) => {
    //             if (discount.oldPrice) {
    //               // Ki·ªÉm tra oldPrice v√† c·∫≠p nh·∫≠t defaultPrice
    //               let defaultPriceFound = false;
    //               discount.oldPrice.forEach((oldItem) => {
    //                 if (oldItem.defaultPrice) {
    //                   defaultPriceFound = true;
    //                   oldItem.defaultPrice = false; // Set oldPrice's defaultPrice to false
    //                 }
    //               });
    //               // N·∫øu t√¨m th·∫•y defaultPrice trong oldPrice, th√¨ set parent defaultPrice to true
    //               if (defaultPriceFound) {
    //                 discount.defaultPrice = true;
    //               }
    //             }
    //           });
    //           // ƒê·∫©y d·ªØ li·ªáu v√†o discountPrice
    //           newItem.discountPrice.push(...updatedDataDiscount);
    //           let dataDefault = updatedDataDiscount?.find(
    //             (c) => c.defaultPrice == true
    //           );
    //           // Tr·∫£ v·ªÅ ƒë·ªëi t∆∞·ª£ng m·ªõi c·ªßa item, v·ªõi th√¥ng tin t·ª´ item v√† gi√° ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t
    //           // return {
    //           //   ...item, // Gi·ªØ l·∫°i t·∫•t c·∫£ c√°c thu·ªôc t√≠nh c·ªßa item
    //           //   discountPrice: updatedPrice.length > 0 ? updatedPrice : null, // G·∫Øn gi√° v√†o item, n·∫øu c√≥ gi√°
    //           // };
    //           return {
    //             ...newItem,
    //             type:
    //               dataDefault?.type != "PROMOTION"
    //                 ? dataDefault?.type
    //                 : dataDefault?.oldPrice[0]?.type,
    //             discountPrice: updatedDataDiscount.length > 0 ? updatedDataDiscount : [],
    //           };
    //         }),
    //       };
    //     });
    //     console.log(
    //       "üöÄ ~ this.product=data.data.getPriceMenus.map ~ this.product:",
    //       this.product
    //     );
    //   }
    //   //this.product = data?.data?.getPriceMenus;
    // },
  },
};
</script>
<style lang="scss" scoped>
.container {
  padding-bottom: 20px;
}
.pricing-area:nth-of-type(2n-1) {
  background: #eef6fd;
}
</style>
